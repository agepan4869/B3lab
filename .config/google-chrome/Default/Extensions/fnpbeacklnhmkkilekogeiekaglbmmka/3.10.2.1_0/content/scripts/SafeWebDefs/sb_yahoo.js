(function(m){m.NSSS.sb_yahoo=function(m,t){var p=t.utils.isntNil,q=t.utils.isNil,g=m.constants,x=t.extensionAdapter,y=t.utils,r=m.uiConstants.MESSAGES,z=m.NSSSHelper,d={},v=!1,A=!1,B=!1,C=!1,u=[],w=[];d.initialize=function(){if(p(Shasta)){var m=function(a){a=a?a:window.event;window.event?a.cancelBubble=!0:a.stopPropagation()};d.parsePage=function(){var a=function(){var a=!0;"hk.search.yahoo.com"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[contains(@id,'web') or contains(@id,'kp') or contains(@id,'ysch')]//li/div//a[contains(@class,'ttl')]"),
Utils.execSearchQuery("//div[starts-with(@class,'compTitle')]/h3[@class='title']/a"),Utils.execSearchQuery("//div[contains(@class,'sc-knowledge')]//li/a[not(child::img)][1]"),Utils.execTopBtmSponsQuery("//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li/div[not(contains(@class, 'abs'))]/a[not(contains(@class, 'nradan'))][1]","//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li/em[1]"),Utils.execRightSponsQuery("//div[@id='east' or contains(@id,'sec')]//ul/li[not(@class)]/a[not(child::img)]",
"//div[@id='east' or contains(@id,'sec')]//li[not (@class='yschprom')]//em[(not(@class))][1]"),Utils.execSearchQuery("//div[@id='yschiy']/cite/a[not(child::img)]"),Utils.execSearchQuery("//div[@class='res sc']//div/a[contains(@class,'spt')]"),Utils.execRightSponsQuery("//div[@id='east']/ul[starts-with(@class,'ead')]//li/a","//div[@id='east']/ul[starts-with(@class,'ead')]//li/em"),a=!1,v=!0):"hk.m.search.yahoo.com"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[contains(@id,'web') or contains(@id,'kp')]//li/div//a[contains(@class,'ttl')]"),
Utils.execSearchQuery("//div[starts-with(@class,'compTitle')]/h3[@class='title']/a"),Utils.execSearchQuery("//div[contains(@class,'sc-knowledge')]//li/a[not(child::img)][1]"),Utils.execTopBtmSponsQuery("//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li/div/a[not(child::img)][1]","//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li/em[1]"),Utils.execRightSponsQuery("//div[@id='east' or contains(@id,'sec')]//ul/li[not(@class)]/a[not(child::img)]","//div[@id='east' or contains(@id,'sec')]//li[not (@class='yschprom')]//em[(not(@class))][1]"),
Utils.execSearchQuery("//div[@id='yschiy']/cite/a[not(child::img)]"),Utils.execSearchQuery("//div[@class='res sc']//div/a[contains(@class,'spt')]"),Utils.execRightSponsQuery("//div[@id='east']/ul[starts-with(@class,'ead')]//li/a","//div[@id='east']/ul[starts-with(@class,'ead')]//li/em"),a=!1,v=!0):"kr.search.yahoo.com"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[@id='web']//li//div/h3/a[not(child::img)]"),Utils.execSearchQuery("//div[starts-with(@id,'bl') or @id='vdo']//li/div[@class='cn']/h4/a[not(child::img)]"),
Utils.execSearchQuery("//div[@id='ks2']//div[@class='box']/p/a[not(child::img)]"),Utils.execSearchQuery("//div[@id='vpr']//div/strong//a[not(child::img)]"),Utils.execSearchQuery("//div[@id='nws']//div[@class='box']//div[@class='rt']/p/a[not(child::img)]"),Utils.execSearchQuery("//div[@id='gg1']//div[@class='box']/span/p/a[not(child::img)]"),Utils.execSearchQuery("//div[@id='go']//dd/strong//a[not(child::img)and not(parent::span)]"),Utils.execSearchQuery("//div[@id='dic']//dd/span/a[1][not(child::img)]"),
Utils.execSearchQuery("//div[(@id='poi')]//div/h5//a[contains(@class,'spt')]"),Utils.execSearchQuery("//div[@id='sp1']//dd//a[(parent::h3) or ((parent::dd) and not(child::img))]"),Utils.execSearchQuery("//div[@class='yiy']/h4[(preceding-sibling::span)]/a[1]"),Utils.execTopBtmSponsQuery("//div[contains(@class,'special-link')]//li//h3/a[not(child::img) and not(@class)]","//div[contains(@class,'special-link')]//li/em[1]"),Utils.execTopBtmSponsQuery("//div[contains(@class,'premium-link')]//li//h3/a[not(child::img) and not(@class)]",
"//div[contains(@class,'premium-link')]//li/div/a[not(child::img) and not(@class)]"),Utils.execTopBtmSponsQuery("//div[starts-with(@class,'ads horiz ')]//ul[@class='spns']//div[not(@class)]/a[not(child::img)]","//div[starts-with(@class,'ads horiz ')]//ul[@class='spns']//em/a[not(@class) and not(child::img)]"),A=!0):"search.yahoo.co.jp"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[@id='mIn']//div[@class='hd']//h3/a"),Utils.execSearchQuery("//div[@id='mIn']//div[@class='bd']//div[@class='row']//ul/li//a[not(child::img)]"),
Utils.execTopBtmSponsQuery("//div[@id='mIn']//div[@class='bd']//ul/li//a[@class='t' and not(child::img)]","//div[@id='mIn']//div[@class='bd']//ul/li//span[@class='u']"),Utils.execTopBtmSponsQuery("//div[@id='mIn']//div[@class='bd']//h3/a","//div[@id='mIn']//div[@class='bd']//div[contains(@class,'cf') and not(contains(@class,'st1'))]/span[1]"),Utils.execRightSponsQuery("//div[@id='sIn']//div[@class='bd']//a[not(child::img)]","//div[@id='sIn']//div[@class='bd']//span[@class='u']"),B=!0):"search.cn.yahoo.com"===
window.location.hostname.toLowerCase()||"one.cn.yahoo.com"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[@class='rst' or @class='yst-web']//h3/a[not(child::img)]"),Utils.execTopBtmSponsQuery("//div[contains(@class,'p4p') or contains(@id,'p4p')]//h3/em[1]","//div[contains(@class,'p4p') or contains(@id,'p4p')]//h3/em[1]"),Utils.execRightSponsQuery("//div[@class='pr']//a[@class='pa']//em","//div[@class='pr']//a[@class='pa']//div[@class='f1']//div[@class='rel']")):-1!=window.location.href.indexOf("http://www.yahoo.cn/s?")||
-1!=window.location.href.indexOf("https://www.yahoo.cn/s?")?(Utils.execSearchQuery("//div[@class='main_content']/div[@class='content']/ul[@class='results']/li[@class='record']/h3[@class='title']/a"),Utils.execSearchQuery("//div[@class='main_content']/div[@class='content']/ul[@class='results']/li[@class='record sc_news']/div/ul/li/a[@class='sub_title']"),Utils.execSearchQuery("//div[@class='main_content']/div[@class='content']/ul[@class='results']/li[@class='record']/ul[@class='sitelink']/li/a")):
"ca.search.yahoo.com"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[@id='web']//a[contains(@class,'yschttl')]"),Utils.execSearchQuery("//div[starts-with(@class,'compTitle')]/h3[@class='title']/a"),Utils.execTopBtmSponsQuery("//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li/div/a[not(contains(@class,'pp-'))and not(child::img)]","//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li//em[1]"),Utils.execRightSponsQuery("//div[@id='east']//li[not(@class)]/a[not(child::img)]",
"//div[@id='east']//li//em[1]"),Utils.execRightSponsQuery("//div[@id='east']/ul[starts-with(@class,'ead')]//li/a","//div[@id='east']/ul[starts-with(@class,'ead')]//li/em"),a=!1):"tw.search.yahoo.com"===window.location.hostname.toLowerCase()?(Utils.execSearchQuery("//div[contains(@id,'web')]//a[contains(@class,'ttl')]"),Utils.execSearchQuery("//div[starts-with(@class,'compTitle')]/h3[@class='title']/a"),Utils.execTopBtmSponsQuery("//div[starts-with(@class,'adStd')]/div[not(@class)]/a","//div[starts-with(@class,'adStd')]/a[starts-with(@class,'test')]"),
Utils.execSearchQuery("//div[contains(@class,'sc-knowledge') or contains(@class,'sc-shopping')]//li/a[not(child::img)]"),Utils.execSearchQuery("//div[@class='res sc']/div[contains(@class,'ttl')]/a[contains(@class,'spt')and not(child::img)]")):-1!=window.location.href.indexOf("http://search.yahoo.com/sponsored_search")||-1!=window.location.href.indexOf("https://search.yahoo.com/sponsored_search")?Utils.execTopBtmSponsQuery("//div[@id='ad-srp']//li//h3/a[not(child::img)]","//div[@id='ad-srp']//li//div[(@class='res')]/span[(@class='url')]"):
-1!=window.location.href.indexOf("search/dir")?(Utils.execSearchQuery("//div[contains(@id,'web')]//a[contains(@class,'ttl')]"),Utils.execTopBtmSponsQuery("//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li/div[not(@class='abst')]/a[1 and not(@class) and not(child::img)]","//div[contains(@class,'spns') or contains(@class,'ads horiz')]//li//em[1 and not(parent::a)]")):(Utils.execSearchQuery("//div[contains(@id,'web')]//h3//a[1]"),Utils.execSublinksSearchQuery("//div[contains(@id,'web')]//li[contains(@class, 'mb-12')]//a"),
Utils.execTopBtmSponsQuery("//ul[contains(@class,'spns') or contains(@class,'ads horiz') or contains(@class,'eads')]/li/div[contains(@class,'ad-ttl') or contains(@class,'vert-ad-ttl')]/a[not(child::img)]","//ul[contains(@class,'spns') or contains(@class,'ads horiz') or contains(@class,'eads')]//li/em[1 and not(parent::a)]"));a&&(Utils.execRightSponsQuery("//div[contains(@class,'bcae') or contains(@class, 'bcaw')]//h3[@class='title']//a[1]","//div[contains(@class,'bcae') or contains(@class, 'bcaw')]//div[contains(@class,'compTitle')]//div//a[1]"),
"in.search.yahoo.com"===window.location.hostname.toLowerCase()&&Utils.execRightSponsQuery("//div[@class='mod glue-spl']//li[not (@class='yschprom')]//a[(not(@class) and not(child::img))]","//div[@class='mod glue-spl']//li[not (@class='yschprom')]//em[1]"));Utils.execSearchQuery("//div[starts-with(@class,'res sc')]//tr/td[@class='news-r']//li/a[not(child::img)]");Utils.execSearchQuery("//ul[contains(@class,'compArticleList')]//li/h4//a[1]");Utils.execSearchQuery("//div[@class='shpnr']//*[contains(@class,'ttl')]");
Utils.execTopBtmSponsQuery("//div[contains(@class,'bcas') or contains(@class, 'bcan')]//h3[@class='title']//a[1]","//div[contains(@class,'bcas') or contains(@class, 'bcan')]//div[contains(@class,'compTitle')]//div//a[not(contains(@class, 'thmb'))][1]");Utils.execTopBtmSublinksQuery("//div[contains(@class,'bcas') or contains(@class, 'bcan')]//div[@class='layoutCenter']//div[contains(@class,'compList')]//a");Utils.execImageSponsQuery("//ul[contains(@class,'compImageList') and contains(@class, 'p-sta')]//li[contains(@class, 'm-0')]//a[contains(@class,'thmb')]");
Utils.execSearchQuery("//div[starts-with(@class,'res sc') and (following::div[contains(@id,'web')])]//a[contains(@class,'yschttl')]");Utils.execSearchQuery("//div[starts-with(@class,'res sc')]/h4/a[(not(@class) or (@class='spt')) and not(child::img)]");Utils.execSearchQuery("//div[contains(@class,'navset')]//div[contains(@class,'cnt')]//li[not(@class)]/a[not(child::img)]");Utils.execSearchQuery("//div[contains(@class,'sc-clues')]//a[contains(@class,'ttl')and not(child::img)]");Utils.execSearchQuery("//div[@id='main']//ol[@id='quickapp-prompt']//li//a[contains(@class,'ttl')and not(child::img)]");
Utils.execSearchQuery("//div[contains(@class,'tabview-content')]//li//div[contains(@class,'accrdn-panel')]//div[@class='wt-bd']/h3/a[not(child::img)]");Utils.execSearchQuery("//div[contains(@class,'tabview-content')]//li//div[contains(@class,'accrdn-panel')]//li/h3/a[not(child::img)]")},c=function(a,f){f=["/**","/*-"];var b;a=a.replace(/\u200B|\u2060/g,"");a=unescape(a);a=Utils.getFormatLink(a);for(var e=0;e<f.length&&-1==(b=a.lastIndexOf(f[e]));e++);b=-1!=b?a.slice(b+f[e].length):a;if(b.match(/rlid/)&&
b.match(/u=/)){if(f=b.indexOf("u="),a=b.indexOf("&rlid"),-1!=f&&-1!=a&&f<a){a=b.substring(f+2,a);f="";try{f=atob(a)}catch(E){x.sendMessage({name:r.CLICK_PREVENTION_FAILURE_TELEMETRY,message:{url:encodeURIComponent(b)}}),f=""}f=decodeURIComponent(f);b=new URI(f);a=URI.parseQuery(b._parts.query);b=a.MPRE;q(b)&&(b=a.ds_dest_url,q(b)&&(b=Utils.getFormatLink(f)))}}else b.match(/\.yahoo\.com/)&&b.match(/RU=/)&&(b=b.slice(b.lastIndexOf("RU=")+3),b=b.slice(0,b.indexOf("/RK=")));return encodeURI(b)};if(p(Utils)){a();
a=[];a=Utils.getSearchText();if(0>=a.length)return!1;u=Utils.getSearchNodes();for(var h=z.isYahooSERPPage(window.location.href),e=0;e<a.length;e++){var d=c(a[e],u[e]);if(h){var k=Utils.isAdvtLink(e);Shasta.addURL(d,k)}else Shasta.addURL(d,null)}}return!0};d.handleMessage=function(a,c,h){switch(a.name){case r.UNDO_CLICK_PREVENTION:w.forEach(function(e){e.domain.toLowerCase()==a.undoDomain.toLowerCase()&&e[g.CLICK_PREVENTION_NODE_LIST].forEach(function(a){d.undoClickPrevention(a)})});break;case r.REDO_CLICK_PREVENTION:w.forEach(function(a){var e=
y.createNewGuid(),c=Shasta.getURLObject(a.index);a[g.CLICK_PREVENTION_NODE_LIST].forEach(function(a){d.doClickPrevention(a,c,e)})})}};d.undoClickPrevention=function(a){q(a)||x.sendMessage({name:r.RETRIEVE_CLICK_PREVENTION_URL,message:{clickPreventionUrlID:a.dataset[g.CLICK_PREVENTION_GUID]}},function(c){p(c)&&p(c.url)&&(a.href=c.url,a.parentNode.removeEventListener(g.events.CLICK,d.stopPropagation,!0),a.parentNode.removeEventListener(g.events.MOUSE_DOWN,d.stopPropagation,!0))})};d.stopPropagation=
function(a){a.stopPropagation();return!1};d.doClickPrevention=function(a,c,h){var e=new URI(c.url),m=new URI(a.href);e={url:a.href,urlIdentifier:h,replacedUrl:e.toString()};var k=m.search(!0)[g.URL_IDENTIFIER];p(k)&&p(a.dataset[g.ACTUAL_HREF])&&(e.url=a.dataset[g.ACTUAL_HREF]);x.sendMessage({name:r.STORE_CLICK_PREVENTION_URL,message:e},function(e){if(p(e)&&p(e.inClickPreventionMap)){var f=new URI(c.url);f=f.scheme()+"://"+f.hostname()+f.path()+"?"+g.URL_IDENTIFIER+"="+h;!1===e.inClickPreventionMap&&
(q(k)&&(a.dataset[g.ACTUAL_HREF]=a.href),a.href=f,a.parentNode.addEventListener(g.events.CLICK,d.stopPropagation,!0),a.parentNode.addEventListener(g.events.MOUSE_DOWN,d.stopPropagation,!0));a.dataset[g.CLICK_PREVENTION_GUID]=h}})};d.performClickAttribution=function(){z.isYahooSERPPage(window.location.href)&&u.forEach(function(a,c){var h=Shasta.getURLObject(c),e=a.href;if("sb_unsafeAnnotation.svg"===h.srcimage){var m=Utils.getSearchFlags()[c];if(!Utils.isNormalLink(c)&&!q(h.url)){var k=y.createNewGuid(),
n={};n[g.CLICK_PREVENTION_NODE_LIST]=[];n.href=h.url;n.domain=(new URI(h.url)).domain();n.index=c;n[g.CLICK_PREVENTION_NODE_LIST].push(a);d.doClickPrevention(a,h,k);if(m===Utils.constants.TOP_BOTTOM_SUBLINKS||m===Utils.constants.RIGHT_IMAGE_LINKS)w.push(n);else{c=a.closest(".compTitle");var f=c.querySelector("div > a");n[g.CLICK_PREVENTION_NODE_LIST].push(f);d.doClickPrevention(f,h,k);f=e.indexOf("u=");var b=e.indexOf("&rlid");-1!=f&&-1!=b&&f<b?(e=e.substring(f+2,b),e="div.compText a[href*="+e+"]"):
e="div.compText a";c=c.nextElementSibling;f=[];"layoutCenter"===c.getAttribute("class")&&(f=c.querySelectorAll(e));f.forEach(function(a){n[g.CLICK_PREVENTION_NODE_LIST].push(a);d.doClickPrevention(a,h,k)},k);w.push(n);a=a.closest({right:"div[class*=bcae], div[class*=bcaw]",topbottom:"div[class*=bcas], div[class*=bcan]"}[m]);p(a)&&(a.style.cursor="")}}}})};d.createAnnotation=function(){var a=function(a,b){var f=!1,c=a.parentNode,h=a.nextSibling,D=!1;if(!c)return!1;if(!0!==Utils.isAlreadyAnnotated(c)){b.style.cssFloat=
b.style.styleFloat="none";b.style.display="inline";A&&"p"!=c.nodeName.toLowerCase()&&(b.style.top="0px");if(v&&d[k].toLowerCase()==Utils.constants.TOP_BOTTOM){var l=document.createElement("span");l.style.display="inline";a.style.display="inline";l.onclick=m;l.appendChild(b);b=document.createElement("br");l.appendChild(b);b=l}B&&540<c.clientWidth&&(l=document.createElement("br"),c.appendChild(l));h||(D=!0);if(D)v&&d[k].toLowerCase()==Utils.constants.RIGHT&&(a.currentStyle?b.style.marginLeft=a.currentStyle.marginLeft:
window.getComputedStyle&&(a=window.getComputedStyle(a,null))&&(b.style.marginLeft=a.getPropertyValue("margin-left"))),c.appendChild(document.createTextNode(" ")),l=document.createElement("span"),l.style.display="inline",l.onclick=m,d[k].toLowerCase()==Utils.constants.RIGHT_IMAGE_LINKS&&(b.style.display="none"),l.appendChild(b),c.appendChild(l);else{d[k].toLowerCase()!=Utils.constants.NORMAL&&h&&"em"==h.nodeName.toLowerCase()&&(f=!0);d[k].toLowerCase()==Utils.constants.RIGHT_IMAGE_LINKS&&(b.style.display=
"none");if(f||d[k].toLowerCase()==Utils.constants.RIGHT)a.style.display="inline";c.insertBefore(document.createTextNode(" "),h);c.insertBefore(b,h);f&&(b=document.createElement("br"),c.insertBefore(b,h),C=!0,e[g++]=c)}return!0}},c=function(){var a=Utils.IsSAEnabled();if(a)for(var c=0;c<e.length;c++){for(var d=0,h=0,k=!1,g=e[c].parentNode.getElementsByTagName("img"),l=0;l<g.length;l++)-1!=g[l].src.indexOf(Shasta.getResProtocol())&&(d=l),g[l].src.match(r)&&(h=l,b=!0);if(b)if(h<d)g[h].style.cssFloat=
g[h].style.styleFloat="left",g[d].style.left="5px";else{for(d=g[h].parentNode.nextSibling;null!=d;){if("em"==d.nodeName.toLowerCase()){k=!0;break}d=d.nextSibling}if(k)for(k=e[c].childNodes.length,d=e[c].childNodes,h=0;h<k;h++){g=d[h];if("br"==g.nodeName.toLowerCase()||"em"==g.nodeName.toLowerCase())break;3!=g.nodeType&&(g.style.cssFloat=g.style.styleFloat="left")}}}(b||!a&&++f>q)&&clearInterval(t)};if(p(Utils)){if(0>=u.length)return!1;var d=[],e=[],g=0;d=Utils.getSearchFlags();for(var k=0;k<u.length;k++){var n=
Utils.createImage(k);if(!a(u[k],n))return!1}if(C){var f=0,b=!1;a=Utils.getSADetectInterval();var q=Utils.getSADetectCnt();Utils.ResetSAEnabled();var r=Utils.getSAProtocol(),t=setInterval(c,a)}}return!0}}};d.initialize();return d}(m.NSSS,m.SymBfw)})(executionContext);SymBfw.extensionAdapter.addMessageListener(NSSS.sb_yahoo.handleMessage);
